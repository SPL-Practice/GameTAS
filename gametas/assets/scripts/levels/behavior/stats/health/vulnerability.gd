extends "res://assets/scripts/levels/behavior/stats/value/stat.gd"

signal max_health_updated(max_health)

signal damage()
signal heal()
signal killed()

export (int) var max_health = 1 setget _set_max_hp

func _ready():
	max_heal()
	
func is_killed():
	return value == 0

func sap(amount):
	_set_value(value - amount)

func damage(amount):
	sap(amount)
	emit_signal("damage")

func heal(amount):
	_set_value(value + amount)
	emit_signal("heal")

func max_heal():
	_set_value(max_health)
	
func up(amount):
	_set_max_hp(max_health + amount)
	emit_signal("heal")

func _set_max_hp(next):
	max_health = next
	emit_signal("max_health_updated", max_health)
	_set_value(max_health)

func _set_value(next):
	_compare_health(clamp(next, 0, max_health))

func _compare_health(next):
	if next != value:
		._set_value(next)
		emit_signal("value_updated", value)
		if (is_killed()):
			emit_signal("killed")
