extends "res://assets/scripts/levels/entities/stats/stat.gd"

signal health_updated(health)
signal max_health_updated(max_health)
signal killed()

export (int) var max_health = 1 setget _set_max_hp

func _ready():
	max_heal()
	
func is_killed():
	return value == 0

func damage(amount):
	_set_value(value - amount)

func heal(amount):
	_set_value(value + amount)

func max_heal():
	_set_value(max_health)

func _set_max_hp(next):
	max_health = next
	emit_signal("max_health_updated", max_health)
	_set_value(max_health)

func _set_value(next):
	_compare_health(clamp(next, 0, max_health))

func _compare_health(next):
	if next != value:
		._set_value(next)
		emit_signal("health_updated", value)
		if (is_killed()):
			emit_signal("killed")
